# document.dispatchEvent(new Event('mousedown')) ä½œç”¨åˆ†æ

## ğŸ“‹ æ·±åº¦åˆ†æ

### 1. `document.dispatchEvent(new Event('mousedown'))` çš„ä½œç”¨

#### ğŸ§  æ‚¨çš„ç–‘é—®åˆ†æ

æ‚¨çš„é—®é¢˜éå¸¸ç²¾å‡†ï¼è®©æˆ‘é‡æ–°åˆ†æè¿™ä¸ªè®¾è®¡ï¼š

#### äº‹ä»¶ä¼ æ’­æœºåˆ¶
```typescript
// iframeå†…çš„mousedownäº‹ä»¶ç›‘å¬å™¨
doc.addEventListener('mousedown', (downEvent: MouseEvent) => {
  // 1. ä¸»åŠ¨è§¦å‘å®¿ä¸»ç¯å¢ƒçš„äº‹ä»¶
  document.dispatchEvent(new Event('mousedown')); // å®¿ä¸»ç¯å¢ƒçš„document

  // 2. åç»­æ¡ä»¶æ€§é˜»æ­¢åŸç”Ÿäº‹ä»¶ä¼ æ’­
  if (/* æ™®é€šèŠ‚ç‚¹ */) {
    downEvent.stopPropagation();  // é˜»æ­¢iframeå†…äº‹ä»¶å†’æ³¡
    downEvent.preventDefault();   // é˜»æ­¢é»˜è®¤è¡Œä¸º
  }
  // RGLèŠ‚ç‚¹ä¸é˜»æ­¢ï¼Œå…è®¸å†’æ³¡
}, true); // æ•è·é˜¶æ®µ
```

#### ğŸ¯ è®¾è®¡æ„å›¾åˆ†æ

**ä¸ºä»€ä¹ˆéœ€è¦æ‰‹åŠ¨dispatchï¼Ÿ**

1. **å¯é çš„å¼¹çª—å…³é—­æœºåˆ¶**
   ```typescript
   // å…ˆç¡®ä¿å¼¹çª—å…³é—­é€»è¾‘è¢«è§¦å‘
   document.dispatchEvent(new Event('mousedown')); // âœ… ä¸»åŠ¨è§¦å‘

   // ç„¶åå†å†³å®šæ˜¯å¦é˜»æ­¢åŸç”Ÿäº‹ä»¶
   if (æ™®é€šèŠ‚ç‚¹) {
     downEvent.stopPropagation(); // âŒ åç»­é˜»æ­¢å†’æ³¡
   }
   ```

2. **é¿å…æ¡ä»¶å¹²æ‰°**
   - å¦‚æœä¾èµ–åŸç”Ÿäº‹ä»¶å†’æ³¡ï¼Œå¼¹çª—å…³é—­é€»è¾‘å¯èƒ½ä¼šè¢«åç»­çš„æ¡ä»¶åˆ¤æ–­å½±å“
   - ä¸»åŠ¨dispatchç¡®ä¿äº†å¼¹çª—å…³é—­çš„ç¡®å®šæ€§

3. **ç²¾ç¡®çš„äº‹ä»¶æ§åˆ¶**
   - å¯ä»¥ç²¾ç¡®æ§åˆ¶å“ªäº›æƒ…å†µä¸‹éœ€è¦å…³é—­å¼¹çª—
   - ä¸ä¼šå› ä¸ºå¤æ‚çš„ä¸šåŠ¡é€»è¾‘è€Œæ„å¤–å½±å“å¼¹çª—çŠ¶æ€

#### ğŸ¤” å¦‚æœä¸æ‰‹åŠ¨dispatchä¼šæ€æ ·ï¼Ÿ

**ç†è®ºä¸Š**ï¼Œå¦‚æœä¸è°ƒç”¨ `preventDefault()`ï¼Œiframeå†…çš„mousedownäº‹ä»¶ä¼šï¼š
1. å…ˆè¢«iframeçš„äº‹ä»¶ç›‘å¬å™¨å¤„ç†
2. ç„¶åå†’æ³¡åˆ°å®¿ä¸»ç¯å¢ƒçš„document
3. è§¦å‘å®¿ä¸»ç¯å¢ƒçš„mousedownç›‘å¬å™¨ï¼Œå…³é—­å¼¹çª—

**ä½†å®é™…é—®é¢˜**ï¼š
- åç»­çš„ä¸šåŠ¡é€»è¾‘å¯èƒ½å¤æ‚ï¼Œå½±å“äº‹ä»¶ä¼ æ’­
- `stopPropagation()` å’Œ `preventDefault()` çš„è°ƒç”¨æ—¶æœºä¸ç¡®å®š
- å¯èƒ½å¯¼è‡´å¼¹çª—å…³é—­ä¸åŠæ—¶æˆ–ä¸ä¸€è‡´

#### ğŸ’¡ æœ€ä½³å®è·µå¯¹æ¯”

**å½“å‰è®¾è®¡ï¼ˆä¸»åŠ¨dispatchï¼‰**ï¼š
```typescript
âœ… å¼¹çª—å…³é—­ç¡®å®šæ€§é«˜
âœ… äº‹ä»¶æ§åˆ¶ç²¾ç¡®
âœ… é€»è¾‘æ¸…æ™°
âŒ éœ€è¦æ‰‹åŠ¨ç®¡ç†äº‹ä»¶
```

**ä¾èµ–åŸç”Ÿå†’æ³¡**ï¼š
```typescript
âœ… ä»£ç ç®€æ´
âŒ å¼¹çª—å…³é—­å¯èƒ½å—ä¸šåŠ¡é€»è¾‘å½±å“
âŒ è°ƒè¯•å›°éš¾
âŒ ä¸å¯æ§æ€§é«˜
```

---

## ğŸ¯ `isRGLContainer` å±æ€§è®¾ç½®æ–¹å¼

### 2. `isRGLContainer` å¦‚ä½•æ·»åŠ ï¼Ÿ

#### æ”¯æŒçš„ä¸‰ç§è®¾ç½®æ–¹å¼

### æ–¹å¼ä¸€ï¼šç»„ä»¶Schemaé…ç½®ï¼ˆæ¨èï¼‰
```javascript
// åœ¨ç»„ä»¶çš„schemaé…ç½®ä¸­æ·»åŠ 
{
  "componentName": "Container",
  "props": {
    // ... å…¶ä»–å±æ€§
  },
  // RGLé…ç½®
  "isRGLContainer": true,          // å¿…éœ€ï¼šæ ‡è®°ä¸ºRGLå®¹å™¨
  "fieldId": "unique_container_id", // å¿…éœ€ï¼šå®¹å™¨çš„å”¯ä¸€æ ‡è¯†
  "layout": []                     // å¿…éœ€ï¼šå¸ƒå±€é…ç½®æ•°ç»„
}
```

### æ–¹å¼äºŒï¼šè¿è¡Œæ—¶ä»£ç è®¾ç½®
```typescript
// é€šè¿‡Nodeå®ä¾‹è®¾ç½®
const node = document.getNode('node_id');
node.isRGLContainer = true;        // è®¾ç½®ä¸ºRGLå®¹å™¨
node.isRGLContainerNode = true;    // å¦ä¸€ç§å†™æ³•
```

### æ–¹å¼ä¸‰ï¼šç»„ä»¶å…ƒæ•°æ®é…ç½®ï¼ˆé«˜çº§ï¼‰
```javascript
// åœ¨ç»„ä»¶æ³¨å†Œæ—¶é€šè¿‡configureé…ç½®
{
  componentName: 'YourRGLContainer',
  configure: {
    props: [
      // ... å±æ€§é…ç½®
    ],
    advanced: {
      // å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°åŠ¨æ€è®¾ç½®
      callbacks: {
        onInit: (node) => {
          if (/* æ»¡è¶³æ¡ä»¶ */) {
            node.isRGLContainer = true;
          }
        }
      }
    }
  }
}
```

### ğŸ“Š å±æ€§è¯´æ˜

| å±æ€§ | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|-----|------|------|------|
| `isRGLContainer` | boolean | æ˜¯ | æ ‡è®°èŠ‚ç‚¹æ˜¯å¦ä¸ºRGLå®¹å™¨ |
| `fieldId` | string | æ˜¯ | å®¹å™¨çš„å”¯ä¸€æ ‡è¯†ï¼Œåœ¨layoutä¸­å¼•ç”¨ |
| `layout` | array | æ˜¯ | å­ç»„ä»¶çš„å¸ƒå±€é…ç½®æ•°ç»„ |

### ğŸ”§ Layouté…ç½®ç¤ºä¾‹
```javascript
{
  "layout": [
    {
      "i": "child_fieldId",    // å­ç»„ä»¶çš„fieldId
      "x": 0,                  // xåæ ‡ï¼ˆç½‘æ ¼å•ä½ï¼‰
      "y": 0,                  // yåæ ‡ï¼ˆç½‘æ ¼å•ä½ï¼‰
      "w": 6,                  // å®½åº¦ï¼ˆç½‘æ ¼å•ä½ï¼‰
      "h": 4                   // é«˜åº¦ï¼ˆç½‘æ ¼å•ä½ï¼‰
    }
  ]
}
```

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…éœ€å±æ€§**: `isRGLContainer`ã€`fieldId`ã€`layout` æ˜¯åŒæ—¶å¿…éœ€çš„
2. **å”¯ä¸€æ ‡è¯†**: æ¯ä¸ªRGLå®¹å™¨å’Œå­ç»„ä»¶çš„ `fieldId` å¿…é¡»å”¯ä¸€
3. **å…¼å®¹æ€§**: `isRGLContainerNode` æ˜¯ `isRGLContainer` çš„åˆ«å
4. **è®¾ç½®æ—¶æœº**: å¯ä»¥åœ¨ç»„ä»¶åˆ›å»ºæ—¶æˆ–è¿è¡Œæ—¶åŠ¨æ€è®¾ç½®

### ğŸ”„ å®Œæ•´ç¤ºä¾‹

```javascript
// å®Œæ•´RGLå®¹å™¨é…ç½®
{
  "componentName": "Div",
  "id": "rgl_container_1",
  "props": {},
  "isRGLContainer": true,
  "fieldId": "rgl_container_1",
  "layout": [
    {
      "i": "child_1",
      "x": 0,
      "y": 0,
      "w": 6,
      "h": 4
    }
  ],
  "children": [
    {
      "componentName": "Button",
      "id": "child_1",
      "props": { "children": "æŒ‰é’®" },
      "fieldId": "child_1"
    }
  ]
}
```

### ğŸ“ æ€»ç»“

- **`document.dispatchEvent(new Event('mousedown'))`**: ç”¨äºå…³é—­ç¼–è¾‘å™¨é¡µé¢çš„å¼¹çª—ï¼Œä¿æŒUIä¸€è‡´æ€§
- **`isRGLContainer`**: å¯ä»¥é€šè¿‡ç»„ä»¶schemaã€è¿è¡Œæ—¶ä»£ç ã€ç»„ä»¶å…ƒæ•°æ®ä¸‰ç§æ–¹å¼è®¾ç½®
- **æœ€ä½³å®è·µ**: æ¨èåœ¨ç»„ä»¶schemaä¸­é…ç½®ï¼Œä¿æŒé…ç½®çš„å¯ç»´æŠ¤æ€§

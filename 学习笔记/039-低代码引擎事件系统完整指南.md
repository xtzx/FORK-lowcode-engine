# ä½ä»£ç å¼•æ“äº‹ä»¶ç³»ç»Ÿå®Œæ•´æŒ‡å—

## ğŸ¯ æ¦‚è¿°

ä½ä»£ç å¼•æ“é‡‡ç”¨**å¤šå±‚äº‹ä»¶ç³»ç»Ÿ**æ¶æ„ï¼ŒåŒ…å«Editoräº‹ä»¶æ€»çº¿ã€Dragonæ‹–æ‹½äº‹ä»¶ã€ç»„ä»¶å†…éƒ¨äº‹ä»¶ç­‰å¤šä¸ªå±‚çº§ï¼Œå®ç°äº†å¤æ‚çš„äº‹ä»¶é©±åŠ¨äº¤äº’ã€‚

## ğŸ“¡ äº‹ä»¶ç³»ç»Ÿæ¶æ„å±‚çº§

### **äº‹ä»¶ç³»ç»Ÿå±‚çº§å›¾**
```mermaid
graph TB
    subgraph "äº‹ä»¶ç³»ç»Ÿæ¶æ„"
        A["1. Editorå…¨å±€äº‹ä»¶æ€»çº¿<br/>packages/editor-core/src/editor.ts"]
        B["2. Dragonæ‹–æ‹½äº‹ä»¶ç³»ç»Ÿ<br/>packages/designer/src/designer/dragon.ts"]
        C["3. Designerè®¾è®¡å™¨äº‹ä»¶<br/>packages/designer/src/designer/designer.ts"]
        D["4. Documentæ–‡æ¡£äº‹ä»¶<br/>packages/designer/src/project"]
        E["5. ç»„ä»¶å†…éƒ¨äº‹ä»¶<br/>å„ç»„ä»¶å†…éƒ¨"]
    end

    A --> B
    A --> C
    C --> D
    B --> D
    D --> E

    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style C fill:#fff3e0
```

## ğŸ“‹ å®Œæ•´äº‹ä»¶åˆ—è¡¨æ¢³ç†

### **ğŸ”¥ Dragonæ‹–æ‹½äº‹ä»¶ç³»ç»Ÿ**
```typescript
// packages/designer/src/designer/dragon.ts - Dragon.emitter
const dragonEvents = {
    // æ ¸å¿ƒæ‹–æ‹½äº‹ä»¶
    'dragstart': {
        trigger: 'dragon.onDragstart()',
        data: 'ILocateEvent',
        purpose: 'æ‹–æ‹½å¼€å§‹é€šçŸ¥'
    },
    'drag': {
        trigger: 'dragon.onDrag()',
        data: 'ILocateEvent',
        purpose: 'æ‹–æ‹½è¿›è¡Œä¸­å®æ—¶æ›´æ–°'
    },
    'dragend': {
        trigger: 'dragon.onDragend()',
        data: '{dragObject, copy}',
        purpose: 'æ‹–æ‹½ç»“æŸå¤„ç†'
    },

    // RGLç‰¹æ®Šäº‹ä»¶
    'rgl.sleeping': {
        trigger: 'RGLåŒºåŸŸè¿›å…¥/é€€å‡º',
        data: 'boolean',
        purpose: 'æ§åˆ¶RGLç³»ç»Ÿæ¿€æ´»çŠ¶æ€'
    },
    'rgl.switch': {
        trigger: 'RGLæ‹–æ‹½å¼€å§‹/ç»“æŸ',
        data: '{action, rglNode}',
        purpose: 'æ§åˆ¶RGLæ‹–æ‹½æµç¨‹'
    },
    'rgl.add.placeholder': {
        trigger: 'RGLå¯æ”¾ç½®ä½ç½®æ£€æµ‹',
        data: '{rglNode, fromRglNode, node, event}',
        purpose: 'æ˜¾ç¤ºRGLæ‹–æ‹½å ä½ç¬¦'
    },
    'rgl.remove.placeholder': {
        trigger: 'RGLåŒºåŸŸé€€å‡ºæˆ–æ‹–æ‹½ç»“æŸ',
        data: 'æ— ',
        purpose: 'ç§»é™¤RGLæ‹–æ‹½å ä½ç¬¦'
    },
    'rgl.drop': {
        trigger: 'RGLç»„ä»¶æˆåŠŸæ”¾ç½®',
        data: '{rglNode, node}',
        purpose: 'å®ŒæˆRGLå¸ƒå±€æ›´æ–°'
    }
};
```

### **ğŸ”¥ Editorå…¨å±€äº‹ä»¶æ€»çº¿**
```typescript
// packages/editor-core/src/editor.ts - Editorç»§æ‰¿EventEmitter
const editorEvents = {
    // ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
    'editor.beforeInit': {
        trigger: 'editor.init()æ‰§è¡Œå‰',
        data: 'Editorå®ä¾‹',
        purpose: 'åˆå§‹åŒ–å‰çš„å‡†å¤‡å·¥ä½œ'
    },
    'editor.afterInit': {
        trigger: 'editor.init()æ‰§è¡Œå',
        data: 'Editorå®ä¾‹',
        purpose: 'åˆå§‹åŒ–å®Œæˆåçš„è®¾ç½®'
    },

    // è®¾è®¡å™¨äº‹ä»¶ï¼ˆé€šè¿‡Designer.postEventè½¬å‘ï¼‰
    'dragstart': {
        trigger: 'Designerè½¬å‘',
        data: 'ILocateEvent',
        purpose: 'å…¨å±€æ‹–æ‹½å¼€å§‹é€šçŸ¥'
    },
    'drag': {
        trigger: 'Designerè½¬å‘',
        data: 'ILocateEvent',
        purpose: 'å…¨å±€æ‹–æ‹½è¿›è¡Œé€šçŸ¥'
    },
    'dragend': {
        trigger: 'Designerè½¬å‘',
        data: 'ILocateEvent + DropLocation',
        purpose: 'å…¨å±€æ‹–æ‹½ç»“æŸé€šçŸ¥'
    },
    'selection.change': {
        trigger: 'é€‰æ‹©çŠ¶æ€å˜åŒ–',
        data: 'Selectionå®ä¾‹',
        purpose: 'èŠ‚ç‚¹é€‰æ‹©çŠ¶æ€å˜åŒ–é€šçŸ¥'
    },
    'history.change': {
        trigger: 'å†å²è®°å½•å˜åŒ–',
        data: 'Historyå®ä¾‹',
        purpose: 'æ’¤é”€é‡åšçŠ¶æ€å˜åŒ–'
    },
    'document.remove': {
        trigger: 'æ–‡æ¡£ç§»é™¤',
        data: '{id: documentId}',
        purpose: 'æ–‡æ¡£åˆ é™¤é€šçŸ¥'
    }
};
```

### **ğŸ”¥ BuiltinSimulatorHostæ¨¡æ‹Ÿå™¨äº‹ä»¶**
```typescript
// packages/designer/src/builtin-simulator/host.ts
const simulatorEvents = {
    // ç»„ä»¶é€‰æ‹©äº‹ä»¶
    'designer.builtinSimulator.select': {
        trigger: 'setupDragAndClickä¸­çš„é€‰æ‹©',
        data: '{selected: componentName}',
        purpose: 'é€šçŸ¥ç»„ä»¶è¢«é€‰ä¸­'
    },
    'designer.builtinSimulator.contextmenu': {
        trigger: 'å³é”®èœå•è§¦å‘',
        data: '{node, originalEvent, componentInstance}',
        purpose: 'æ˜¾ç¤ºç»„ä»¶å³é”®èœå•'
    },

    // ç¦ç”¨äº‹ä»¶æ§åˆ¶
    'designer.builtinSimulator.disabledEvents': {
        trigger: 'é¢æ¿æ“ä½œå¼€å§‹/ç»“æŸ',
        data: '{disabled: boolean}',
        purpose: 'æš‚æ—¶ç¦ç”¨ç”»å¸ƒäº‹ä»¶å“åº”'
    }
};
```

### **ğŸ”¥ Documentæ–‡æ¡£çº§äº‹ä»¶**
```typescript
// packages/designer/src/document/ ç›¸å…³æ–‡ä»¶
const documentEvents = {
    // èŠ‚ç‚¹äº‹ä»¶
    'node.add': {
        trigger: 'èŠ‚ç‚¹æ·»åŠ ',
        data: '{node, index}',
        purpose: 'èŠ‚ç‚¹ç»“æ„å˜æ›´é€šçŸ¥'
    },
    'node.remove': {
        trigger: 'èŠ‚ç‚¹åˆ é™¤',
        data: '{node, index}',
        purpose: 'èŠ‚ç‚¹åˆ é™¤é€šçŸ¥'
    },
    'node.prop.change': {
        trigger: 'èŠ‚ç‚¹å±æ€§å˜åŒ–',
        data: '{node, prop, oldValue, newValue}',
        purpose: 'å±æ€§å˜æ›´é€šçŸ¥ï¼Œè§¦å‘é‡æ¸²æŸ“'
    },

    // é€‰æ‹©äº‹ä»¶
    'selection.change': {
        trigger: 'é€‰æ‹©çŠ¶æ€å˜æ›´',
        data: 'Selectionå®ä¾‹',
        purpose: 'é€‰æ‹©å˜åŒ–é€šçŸ¥'
    }
};
```

## ğŸ› ï¸ åœ¨ä¸šåŠ¡ä¸­ç›‘å¬äº‹ä»¶çš„æ–¹æ³•

### **1. ç›‘å¬å…¨å±€Editoräº‹ä»¶**
```typescript
// é€šè¿‡Editoräº‹ä»¶æ€»çº¿ç›‘å¬
import { editor } from '@alilc/lowcode-engine';

// ç›‘å¬æ‹–æ‹½äº‹ä»¶
const dragListener = editor.eventBus.on('drag', (e) => {
    console.log('å…¨å±€æ‹–æ‹½äº‹ä»¶:', {
        dragType: e.dragObject?.type,
        position: { x: e.globalX, y: e.globalY },
        targetElement: e.target?.tagName
    });
});

// ç›‘å¬é€‰æ‹©å˜åŒ–
const selectionListener = editor.eventBus.on('selection.change', (selection) => {
    console.log('é€‰æ‹©å˜åŒ–:', {
        selectedCount: selection.selected.length,
        selectedNodes: selection.selected.map(id => selection.getNode(id)?.componentName)
    });
});

// æ¸…ç†ç›‘å¬å™¨
// dragListener();
// selectionListener();
```

### **2. ç›‘å¬Dragonæ‹–æ‹½äº‹ä»¶**
```typescript
// é€šè¿‡Designerçš„Dragonå®ä¾‹ç›‘å¬
const designer = editor.get('designer');

// ç›‘å¬æ‹–æ‹½å¼€å§‹
const dragstartListener = designer.dragon.onDragstart((e) => {
    console.log('æ‹–æ‹½å¼€å§‹:', {
        dragObject: e.dragObject,
        eventType: e.originalEvent.type,
        startPosition: { x: e.globalX, y: e.globalY }
    });
});

// ç›‘å¬RGLäº‹ä»¶
const rglSleepingListener = designer.dragon.emitter.on('rgl.sleeping', (sleeping) => {
    console.log('RGLç³»ç»ŸçŠ¶æ€:', sleeping ? 'ä¼‘çœ ' : 'æ¿€æ´»');
});

const rglPlaceholderListener = designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
    console.log('RGLå ä½ç¬¦æ˜¾ç¤º:', {
        targetContainer: data.rglNode?.componentName,
        draggedComponent: data.node?.componentName
    });
});
```

### **3. ç›‘å¬ç‰¹å®šæ–‡æ¡£äº‹ä»¶**
```typescript
// ç›‘å¬å½“å‰æ–‡æ¡£çš„äº‹ä»¶
const currentDocument = designer.project.currentDocument;

if (currentDocument) {
    // ç›‘å¬é€‰æ‹©å˜åŒ–
    currentDocument.selection.onSelectionChange(() => {
        const selectedNodes = currentDocument.selection.getNodes();
        console.log('å½“å‰æ–‡æ¡£é€‰æ‹©å˜åŒ–:', selectedNodes.map(n => n.componentName));
    });

    // ç›‘å¬å†å²è®°å½•å˜åŒ–
    currentDocument.history.onStateChange(() => {
        console.log('å†å²è®°å½•çŠ¶æ€:', {
            canUndo: currentDocument.history.getState().canUndo,
            canRedo: currentDocument.history.getState().canRedo
        });
    });
}
```

### **4. ç›‘å¬æ¨¡æ‹Ÿå™¨äº‹ä»¶**
```typescript
// ç›‘å¬æ¨¡æ‹Ÿå™¨ç‰¹å®šäº‹ä»¶
editor.eventBus.on('designer.builtinSimulator.select', (data) => {
    console.log('ç»„ä»¶é€‰ä¸­äº‹ä»¶:', data.selected);
});

editor.eventBus.on('designer.builtinSimulator.contextmenu', (data) => {
    console.log('å³é”®èœå•è§¦å‘:', {
        componentName: data.node?.componentName,
        position: { x: data.originalEvent.clientX, y: data.originalEvent.clientY }
    });
});

editor.eventBus.on('designer.builtinSimulator.disabledEvents', (data) => {
    console.log('ç”»å¸ƒäº‹ä»¶çŠ¶æ€:', data.disabled ? 'ç¦ç”¨' : 'å¯ç”¨');
});
```

## ğŸ”§ æ‰“å°äº‹ä»¶ç›‘å¬è€…çš„æ–¹æ³•

### **æ–¹æ³•ä¸€ï¼šé€šè¿‡emitterå†…çœ**
```typescript
// è·å–ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰ç›‘å¬è€…
function printEventListeners(eventName: string) {
    const designer = editor.get('designer');

    // Dragonäº‹ä»¶ç›‘å¬è€…
    const dragonEmitter = designer.dragon.emitter;
    const dragonListeners = dragonEmitter.listeners(eventName);
    console.log(`Dragonäº‹ä»¶"${eventName}"çš„ç›‘å¬è€…:`, dragonListeners);

    // Editoräº‹ä»¶ç›‘å¬è€…
    const editorListeners = editor.eventBus.listeners(eventName);
    console.log(`Editoräº‹ä»¶"${eventName}"çš„ç›‘å¬è€…:`, editorListeners);

    // è¿”å›ç›‘å¬è€…æ•°é‡
    return {
        dragonListeners: dragonListeners.length,
        editorListeners: editorListeners.length,
        total: dragonListeners.length + editorListeners.length
    };
}

// ä½¿ç”¨ç¤ºä¾‹
printEventListeners('drag');
printEventListeners('rgl.add.placeholder');
printEventListeners('selection.change');
```

### **æ–¹æ³•äºŒï¼šäº‹ä»¶ç›‘å¬ä»£ç†**
```typescript
// åˆ›å»ºäº‹ä»¶ç›‘å¬ä»£ç†ï¼Œè¿½è¸ªæ‰€æœ‰äº‹ä»¶
class EventListenerProxy {
    private eventMap = new Map<string, Function[]>();

    wrapEmitter(emitter: any, name: string) {
        const originalOn = emitter.on.bind(emitter);
        const originalEmit = emitter.emit.bind(emitter);

        // ä»£ç†onæ–¹æ³•
        emitter.on = (event: string, listener: Function) => {
            // è®°å½•ç›‘å¬è€…
            if (!this.eventMap.has(event)) {
                this.eventMap.set(event, []);
            }
            this.eventMap.get(event)!.push(listener);

            console.log(`[${name}] æ–°å¢ç›‘å¬è€…:`, event, listener.name || 'åŒ¿åå‡½æ•°');
            return originalOn(event, listener);
        };

        // ä»£ç†emitæ–¹æ³•
        emitter.emit = (event: string, ...args: any[]) => {
            const listeners = this.eventMap.get(event) || [];
            console.log(`[${name}] è§¦å‘äº‹ä»¶"${event}"`, {
                listenersCount: listeners.length,
                data: args
            });

            return originalEmit(event, ...args);
        };
    }

    printAllListeners() {
        console.log('=== æ‰€æœ‰äº‹ä»¶ç›‘å¬è€… ===');
        this.eventMap.forEach((listeners, event) => {
            console.log(`äº‹ä»¶"${event}": ${listeners.length}ä¸ªç›‘å¬è€…`);
            listeners.forEach((listener, index) => {
                console.log(`  ${index + 1}. ${listener.name || 'åŒ¿åå‡½æ•°'}`);
            });
        });
    }
}

// ä½¿ç”¨æ–¹æ³•
const eventProxy = new EventListenerProxy();
const designer = editor.get('designer');

eventProxy.wrapEmitter(designer.dragon.emitter, 'Dragon');
eventProxy.wrapEmitter(editor.eventBus, 'Editor');

// ç¨åæ‰“å°æ‰€æœ‰ç›‘å¬è€…
setTimeout(() => {
    eventProxy.printAllListeners();
}, 5000);
```

### **æ–¹æ³•ä¸‰ï¼šå¼€å‘è€…å·¥å…·å¢å¼º**
```typescript
// åœ¨æ§åˆ¶å°ä¸­å¢å¼ºè°ƒè¯•èƒ½åŠ›
(window as any).debugLowcodeEvents = {
    // ç›‘å¬æ‰€æœ‰äº‹ä»¶
    listenAll() {
        const designer = editor.get('designer');

        // Dragonäº‹ä»¶
        const dragonEvents = ['dragstart', 'drag', 'dragend', 'rgl.sleeping', 'rgl.switch', 'rgl.add.placeholder', 'rgl.remove.placeholder', 'rgl.drop'];
        dragonEvents.forEach(eventName => {
            designer.dragon.emitter.on(eventName, (...args) => {
                console.log(`ğŸ‰ Dragonäº‹ä»¶: ${eventName}`, args);
            });
        });

        // Editoräº‹ä»¶
        const editorEvents = ['editor.beforeInit', 'editor.afterInit', 'dragstart', 'drag', 'dragend', 'selection.change', 'history.change'];
        editorEvents.forEach(eventName => {
            editor.eventBus.on(eventName, (...args) => {
                console.log(`ğŸ“ Editoräº‹ä»¶: ${eventName}`, args);
            });
        });
    },

    // è·å–äº‹ä»¶ç›‘å¬è€…
    getListeners(eventName: string) {
        const designer = editor.get('designer');
        return {
            dragon: designer.dragon.emitter.listenerCount(eventName),
            editor: editor.eventBus.listenerCount(eventName)
        };
    },

    // ç›‘å¬ç‰¹å®šäº‹ä»¶
    listen(eventName: string) {
        const designer = editor.get('designer');

        const dragonListener = designer.dragon.emitter.on(eventName, (...args) => {
            console.log(`ğŸ¯ ç›‘å¬åˆ°Dragonäº‹ä»¶"${eventName}":`, args);
        });

        const editorListener = editor.eventBus.on(eventName, (...args) => {
            console.log(`ğŸ¯ ç›‘å¬åˆ°Editoräº‹ä»¶"${eventName}":`, args);
        });

        return () => {
            dragonListener();
            editorListener();
        };
    }
};

// ä½¿ç”¨æ–¹æ³•
debugLowcodeEvents.listenAll();
debugLowcodeEvents.getListeners('drag');
const stopListening = debugLowcodeEvents.listen('rgl.add.placeholder');
```

## ğŸ“Š äº‹ä»¶é…ç½®é¡¹è¯¦è§£

### **Dragonäº‹ä»¶é…ç½®**
```typescript
// é…ç½®Dragonäº‹ä»¶è¡Œä¸º
const dragonConfig = {
    enableEventLogging: true,         // å¯ç”¨äº‹ä»¶æ—¥å¿—
    enablePerformanceTracking: true, // å¯ç”¨æ€§èƒ½è¿½è¸ª
    maxEventPerSecond: 60,           // æœ€å¤§äº‹ä»¶é¢‘ç‡
    enableEventDebugger: false       // å¯ç”¨äº‹ä»¶è°ƒè¯•å™¨
};

// åº”ç”¨é…ç½®
engineConfig.set('dragonEventConfig', dragonConfig);
```

### **Editoräº‹ä»¶é…ç½®**
```typescript
// Editoräº‹ä»¶æ€»çº¿é…ç½®
const editorEventConfig = {
    maxListeners: 200,               // æœ€å¤§ç›‘å¬å™¨æ•°é‡
    enableErrorHandling: true,       // å¯ç”¨é”™è¯¯å¤„ç†
    eventPrefix: 'lowcode',         // äº‹ä»¶å‰ç¼€
    enableBroadcast: true           // å¯ç”¨äº‹ä»¶å¹¿æ’­
};

// åœ¨Editoræ„é€ æ—¶åº”ç”¨
editor.setMaxListeners(editorEventConfig.maxListeners);
```

## ğŸ® é«˜çº§äº‹ä»¶ç›‘å¬æŠ€å·§

### **äº‹ä»¶è¿‡æ»¤å’Œè½¬æ¢**
```typescript
// äº‹ä»¶è¿‡æ»¤å™¨
class EventFilter {
    constructor(designer: Designer) {
        // åªç›‘å¬ç‰¹å®šç»„ä»¶çš„æ‹–æ‹½
        designer.dragon.onDragstart((e) => {
            const draggedComponent = e.dragObject?.nodes?.[0]?.componentName;

            if (this.shouldTrackComponent(draggedComponent)) {
                this.trackComponentDrag(e);
            }
        });

        // è¿‡æ»¤RGLäº‹ä»¶
        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            if (this.isBusinessRGLContainer(data.rglNode)) {
                this.handleBusinessPlaceholder(data);
            }
        });
    }

    shouldTrackComponent(componentName: string): boolean {
        const trackedComponents = ['Button', 'Input', 'Table'];
        return trackedComponents.includes(componentName);
    }
}
```

### **äº‹ä»¶æ€§èƒ½ç›‘æ§**
```typescript
// äº‹ä»¶æ€§èƒ½ç›‘æ§å™¨
class EventPerformanceMonitor {
    private eventStats = new Map<string, any>();

    constructor(designer: Designer) {
        this.monitorDragonEvents(designer);
        this.monitorEditorEvents(editor);
    }

    monitorDragonEvents(designer: Designer) {
        const events = ['dragstart', 'drag', 'dragend'];

        events.forEach(eventName => {
            designer.dragon.emitter.on(eventName, () => {
                this.recordEvent(eventName);
            });
        });
    }

    recordEvent(eventName: string) {
        const now = Date.now();
        const stats = this.eventStats.get(eventName) || { count: 0, lastTime: 0, avgFreq: 0 };

        stats.count++;
        if (stats.lastTime) {
            const interval = now - stats.lastTime;
            stats.avgFreq = stats.avgFreq ? (stats.avgFreq + interval) / 2 : interval;
        }
        stats.lastTime = now;

        this.eventStats.set(eventName, stats);
    }

    getStats() {
        const result: any = {};
        this.eventStats.forEach((stats, eventName) => {
            result[eventName] = {
                totalCount: stats.count,
                averageFrequency: Math.round(1000 / stats.avgFreq) + 'Hz'
            };
        });
        return result;
    }
}

// ä½¿ç”¨æ–¹æ³•
const monitor = new EventPerformanceMonitor(designer);
setTimeout(() => {
    console.log('äº‹ä»¶æ€§èƒ½ç»Ÿè®¡:', monitor.getStats());
}, 30000);
```

## âš ï¸ äº‹ä»¶ä½¿ç”¨æ³¨æ„äº‹é¡¹

### **1. å†…å­˜æ³„æ¼é˜²æŠ¤**
```typescript
class EventLeakProtection {
    private listeners: Array<() => void> = [];

    addListener(emitter: any, event: string, callback: Function) {
        const removeListener = emitter.on(event, callback);
        this.listeners.push(removeListener);
        return removeListener;
    }

    // ç»„ä»¶å¸è½½æ—¶æ¸…ç†æ‰€æœ‰ç›‘å¬å™¨
    cleanup() {
        this.listeners.forEach(remove => remove());
        this.listeners = [];
    }
}
```

### **2. äº‹ä»¶é¢‘ç‡æ§åˆ¶**
```typescript
// é«˜é¢‘äº‹ä»¶çš„èŠ‚æµå¤„ç†
import { throttle } from 'lodash';

const throttledDragHandler = throttle((e: ILocateEvent) => {
    // å¤„ç†æ‹–æ‹½äº‹ä»¶
    this.updateUI(e);
}, 16); // 60fps

designer.dragon.onDrag(throttledDragHandler);
```

### **3. é”™è¯¯å¤„ç†**
```typescript
// äº‹ä»¶ç›‘å¬çš„é”™è¯¯å¤„ç†
designer.dragon.onDrag((e) => {
    try {
        // ä¸šåŠ¡é€»è¾‘
        this.handleDrag(e);
    } catch (error) {
        console.error('æ‹–æ‹½äº‹ä»¶å¤„ç†é”™è¯¯:', error);
        // ä¸é˜»æ–­å…¶ä»–ç›‘å¬å™¨
    }
});
```

## ğŸ“ˆ äº‹ä»¶ç›‘å¬çš„æœ€ä½³å®è·µ

### **1. äº‹ä»¶åˆ†ç±»ç›‘å¬**
```typescript
class EventManager {
    // æŒ‰åŠŸèƒ½åˆ†ç±»ç›‘å¬
    setupDragEvents() {
        // æ‹–æ‹½ç›¸å…³äº‹ä»¶
    }

    setupSelectionEvents() {
        // é€‰æ‹©ç›¸å…³äº‹ä»¶
    }

    setupDocumentEvents() {
        // æ–‡æ¡£ç›¸å…³äº‹ä»¶
    }
}
```

### **2. æ¡ä»¶æ€§ç›‘å¬**
```typescript
// æ ¹æ®é…ç½®å†³å®šæ˜¯å¦ç›‘å¬æŸäº›äº‹ä»¶
const eventConfig = engineConfig.get('eventConfig', {});

if (eventConfig.enableDragTracking) {
    designer.dragon.onDrag(this.trackDrag);
}

if (eventConfig.enableSelectionAnalytics) {
    editor.eventBus.on('selection.change', this.analyzeSelection);
}
```

## ğŸ¯ æ€»ç»“

### **äº‹ä»¶ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼**
1. **è§£è€¦åˆ**ï¼šé€šè¿‡äº‹ä»¶å®ç°æ¨¡å—é—´çš„æ¾è€¦åˆé€šä¿¡
2. **å¯æ‰©å±•**ï¼šæ”¯æŒä¸šåŠ¡å±‚é¢çš„äº‹ä»¶ç›‘å¬å’Œæ‰©å±•
3. **å¯è§‚æµ‹**ï¼šæä¾›ç³»ç»Ÿè¿è¡ŒçŠ¶æ€çš„å¯è§‚æµ‹æ€§
4. **å¯è°ƒè¯•**ï¼šä¾¿äºå¼€å‘å’Œè°ƒè¯•æ—¶çš„çŠ¶æ€è¿½è¸ª

### **ç›‘å¬è€…åˆ†å¸ƒ**
- **Dragonäº‹ä»¶**ï¼šä¸»è¦è¢«Designerã€æ’ä»¶ã€è°ƒè¯•å·¥å…·ç›‘å¬
- **Editoräº‹ä»¶**ï¼šä¸»è¦è¢«æ’ä»¶ã€ä¸šåŠ¡ä»£ç ã€åˆ†æå·¥å…·ç›‘å¬
- **Documentäº‹ä»¶**ï¼šä¸»è¦è¢«UIç»„ä»¶ã€çŠ¶æ€ç®¡ç†å™¨ç›‘å¬

### **è°ƒè¯•æŠ€å·§**
- ä½¿ç”¨`debugLowcodeEvents`å·¥å…·è¿›è¡Œå…¨é¢ç›‘å¬
- é€šè¿‡äº‹ä»¶ä»£ç†è¿½è¸ªç›‘å¬è€…æ³¨å†Œ
- ä½¿ç”¨æ€§èƒ½ç›‘æ§å™¨åˆ†æäº‹ä»¶é¢‘ç‡
- åˆç†ä½¿ç”¨èŠ‚æµå’Œé˜²æŠ–æ§åˆ¶äº‹ä»¶é¢‘ç‡

**ä½ä»£ç å¼•æ“çš„äº‹ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªå®Œå–„çš„äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œä¸ºå¤æ‚çš„äº¤äº’å’Œæ‰©å±•æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚**

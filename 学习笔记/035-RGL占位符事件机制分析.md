# RGLå ä½ç¬¦äº‹ä»¶æœºåˆ¶åˆ†æ

## ğŸ¯ æ¦‚è¿°

RGLå ä½ç¬¦äº‹ä»¶æ˜¯ä½ä»£ç å¼•æ“ä¸­**ç½‘æ ¼å¸ƒå±€æ‹–æ‹½äº¤äº’çš„æ ¸å¿ƒæœºåˆ¶**ï¼Œé€šè¿‡`rgl.add.placeholder`å’Œ`rgl.remove.placeholder`äº‹ä»¶æ¥æ§åˆ¶æ‹–æ‹½æ—¶çš„è§†è§‰å ä½ç¬¦æ˜¾ç¤ºã€‚

## ğŸ“¡ RGLå ä½ç¬¦äº‹ä»¶è¯¦è§£

### **äº‹ä»¶å®šä¹‰**
| äº‹ä»¶åç§° | è§¦å‘æ—¶æœº | æºå¸¦æ•°æ® | ä½œç”¨ |
|---------|----------|----------|------|
| `rgl.add.placeholder` | RGLåŒºåŸŸå¯æ”¾ç½®æ—¶ | `{rglNode, fromRglNode, node, event}` | æ˜¾ç¤ºæ‹–æ‹½å ä½ç¬¦ |
| `rgl.remove.placeholder` | ç¦»å¼€RGLåŒºåŸŸæ—¶ | æ— æ•°æ® | ç§»é™¤æ‹–æ‹½å ä½ç¬¦ |

### **äº‹ä»¶å‘é€ä½ç½®**

#### **rgl.add.placeholderè§¦å‘**
```typescript
// packages/designer/src/designer/dragon.ts:319-324
if (this._canDrop) {
    // å¯ä»¥æ”¾ç½®ï¼šæ˜¾ç¤ºRGLå ä½ç¬¦
    this.emitter.emit('rgl.add.placeholder', {
        rglNode,                                    // ç›®æ ‡RGLèŠ‚ç‚¹
        fromRglNode,                               // æ¥æºRGLèŠ‚ç‚¹
        node: locateEvent.dragObject?.nodes?.[0], // è¢«æ‹–æ‹½çš„èŠ‚ç‚¹
        event: e,                                  // åŸå§‹äº‹ä»¶
    });
    designer.clearLocation();
    this.clearState();
    this.emitter.emit('drag', locateEvent);
    return;
}
```

#### **è§¦å‘æ¡ä»¶**
1. **isRGL = true**ï¼šå½“å‰ä½ç½®åœ¨RGLå¸ƒå±€åŒºåŸŸå†…
2. **sensor.locate() æˆåŠŸ**ï¼šä¼ æ„Ÿå™¨èƒ½å¤Ÿå®šä½åˆ°æœ‰æ•ˆæŠ•æ”¾ä½ç½®
3. **this._canDrop = true**ï¼šç¡®è®¤å¯ä»¥åœ¨è¯¥ä½ç½®æ”¾ç½®ç»„ä»¶

#### **æºå¸¦æ•°æ®è¯´æ˜**
```typescript
interface RGLPlaceholderEventData {
    rglNode: Node;                    // ç›®æ ‡RGLå®¹å™¨èŠ‚ç‚¹
    fromRglNode?: Node;               // æ¥æºRGLèŠ‚ç‚¹ï¼ˆå¦‚æœæ˜¯RGLå†…ç§»åŠ¨ï¼‰
    node: Node;                       // è¢«æ‹–æ‹½çš„èŠ‚ç‚¹å®ä¾‹
    event: MouseEvent | DragEvent;   // åŸå§‹é¼ æ ‡/æ‹–æ‹½äº‹ä»¶
}
```

#### **rgl.remove.placeholderè§¦å‘**
```typescript
// packages/designer/src/designer/dragon.ts:333
} else {
    // éRGLåŒºåŸŸçš„å¤„ç†
    this._canDrop = false;
    this.emitter.emit('rgl.remove.placeholder'); // ç§»é™¤RGLå ä½ç¬¦
    this.emitter.emit('rgl.sleeping', true);     // RGLç³»ç»Ÿè¿›å…¥ä¼‘çœ 
}

// packages/designer/src/designer/dragon.ts:444
// æ‹–æ‹½ç»“æŸæ—¶ä¹Ÿä¼šæ¸…ç†å ä½ç¬¦
this.emitter.emit('rgl.remove.placeholder');
```

#### **è§¦å‘æ¡ä»¶**
1. **ç¦»å¼€RGLåŒºåŸŸ**ï¼šæ‹–æ‹½ç§»åŠ¨åˆ°éRGLåŒºåŸŸæ—¶
2. **æ‹–æ‹½ç»“æŸ**ï¼šæ— è®ºæˆåŠŸä¸å¦ï¼Œéƒ½æ¸…ç†å ä½ç¬¦
3. **æ‹–æ‹½å–æ¶ˆ**ï¼šESCå–æ¶ˆæˆ–å…¶ä»–ä¸­æ–­æƒ…å†µ

## ğŸ¨ å ä½ç¬¦æ¸²æŸ“æœºåˆ¶æ¨æµ‹

### **å¯èƒ½çš„å®ç°æ–¹æ¡ˆ**

#### **æ–¹æ¡ˆä¸€ï¼šDOMç›´æ¥æ“ä½œï¼ˆæ¨æµ‹ï¼‰**
```typescript
// å¯èƒ½å­˜åœ¨çš„RGLå ä½ç¬¦ç®¡ç†å™¨
class RGLPlaceholderManager {
    private placeholder: HTMLElement | null = null;
    private designer: Designer;

    constructor(designer: Designer) {
        this.designer = designer;
        this.setupEventListeners();
    }

    private setupEventListeners() {
        // ç›‘å¬å ä½ç¬¦æ·»åŠ äº‹ä»¶
        this.designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            this.showPlaceholder(data);
        });

        // ç›‘å¬å ä½ç¬¦ç§»é™¤äº‹ä»¶
        this.designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            this.hidePlaceholder();
        });
    }

    private showPlaceholder(data: any) {
        const { rglNode, node, event } = data;

        // åˆ›å»ºå ä½ç¬¦å…ƒç´ 
        if (!this.placeholder) {
            this.placeholder = this.createPlaceholderElement();
        }

        // è®¡ç®—å ä½ç¬¦ä½ç½®å’Œå¤§å°
        const rect = this.calculatePlaceholderRect(rglNode, node, event);

        // è®¾ç½®å ä½ç¬¦æ ·å¼
        this.placeholder.style.left = `${rect.x}px`;
        this.placeholder.style.top = `${rect.y}px`;
        this.placeholder.style.width = `${rect.width}px`;
        this.placeholder.style.height = `${rect.height}px`;
        this.placeholder.style.display = 'block';

        // æ·»åŠ åˆ°DOM
        rglNode.getDOMNode()?.appendChild(this.placeholder);
    }

    private hidePlaceholder() {
        if (this.placeholder) {
            this.placeholder.style.display = 'none';
            this.placeholder.remove();
        }
    }

    private createPlaceholderElement(): HTMLElement {
        const placeholder = document.createElement('div');
        placeholder.className = 'rgl-drag-placeholder';
        placeholder.style.cssText = `
            position: absolute;
            border: 2px dashed #1890ff;
            background: rgba(24, 144, 255, 0.1);
            pointer-events: none;
            z-index: 9999;
            border-radius: 4px;
        `;
        return placeholder;
    }
}
```

#### **æ–¹æ¡ˆäºŒï¼šReactç»„ä»¶çŠ¶æ€é©±åŠ¨ï¼ˆæ¨æµ‹ï¼‰**
```typescript
// RGLå®¹å™¨ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ç®¡ç†
class RGLContainer extends Component {
    state = {
        placeholderVisible: false,
        placeholderRect: null,
        draggedNode: null
    };

    componentDidMount() {
        // ç›‘å¬Dragonçš„å ä½ç¬¦äº‹ä»¶
        const { designer } = this.props;

        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            if (data.rglNode === this.props.node) {
                this.setState({
                    placeholderVisible: true,
                    placeholderRect: this.calculateRect(data),
                    draggedNode: data.node
                });
            }
        });

        designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            this.setState({
                placeholderVisible: false,
                placeholderRect: null,
                draggedNode: null
            });
        });
    }

    render() {
        const { placeholderVisible, placeholderRect } = this.state;

        return (
            <div className="rgl-container">
                {/* æ­£å¸¸çš„ç½‘æ ¼å¸ƒå±€å†…å®¹ */}
                {this.renderGridItems()}

                {/* æ‹–æ‹½å ä½ç¬¦ */}
                {placeholderVisible && placeholderRect && (
                    <div
                        className="rgl-placeholder"
                        style={{
                            position: 'absolute',
                            left: placeholderRect.x,
                            top: placeholderRect.y,
                            width: placeholderRect.width,
                            height: placeholderRect.height,
                            border: '2px dashed #1890ff',
                            background: 'rgba(24, 144, 255, 0.1)',
                            pointerEvents: 'none'
                        }}
                    />
                )}
            </div>
        );
    }
}
```

## ğŸ” å ä½ç¬¦äº‹ä»¶çš„ç›‘å¬è€…åˆ†æ

### **ç›‘å¬è€…ä½ç½®æ¨æµ‹**

#### **1. RGLç»„ä»¶å†…éƒ¨ç›‘å¬**
```typescript
// RGLå®¹å™¨ç»„ä»¶å¯èƒ½åœ¨å†…éƒ¨ç›‘å¬è¿™äº›äº‹ä»¶
// ä½ç½®ï¼šä¸šåŠ¡ç»„ä»¶æˆ–å†…ç½®RGLç»„ä»¶ä¸­

componentDidMount() {
    const designer = this.getDesigner();

    // ç›‘å¬è‡ªèº«ç›¸å…³çš„å ä½ç¬¦äº‹ä»¶
    this.addPlaceholderListener = designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
        if (data.rglNode.id === this.props.nodeId) {
            this.showPlaceholder(data);
        }
    });

    this.removePlaceholderListener = designer.dragon.emitter.on('rgl.remove.placeholder', () => {
        this.hidePlaceholder();
    });
}
```

#### **2. BemToolsç³»ç»Ÿç›‘å¬**
```typescript
// packages/designer/src/builtin-simulator/bem-tools/å¯èƒ½å­˜åœ¨çš„å ä½ç¬¦å·¥å…·
class RGLPlaceholderTool extends Component {
    componentDidMount() {
        const { designer } = this.props;

        // ç›‘å¬å ä½ç¬¦äº‹ä»¶ï¼Œåœ¨BemToolså±‚æ˜¾ç¤ºå ä½ç¬¦
        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            this.renderPlaceholderInBemLayer(data);
        });

        designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            this.clearPlaceholderInBemLayer();
        });
    }
}
```

#### **3. è°ƒè¯•å’Œå¼€å‘å·¥å…·ç›‘å¬**
```typescript
// å¼€å‘è°ƒè¯•å·¥å…·å¯èƒ½ç›‘å¬è¿™äº›äº‹ä»¶
if (process.env.NODE_ENV === 'development') {
    designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
        console.log('RGLå ä½ç¬¦æ˜¾ç¤º:', {
            targetNode: data.rglNode.componentName,
            draggedComponent: data.node?.componentName,
            position: { x: data.event.clientX, y: data.event.clientY }
        });
    });

    designer.dragon.emitter.on('rgl.remove.placeholder', () => {
        console.log('RGLå ä½ç¬¦ç§»é™¤');
    });
}
```

## ğŸ­ å ä½ç¬¦çš„æ¸²æŸ“æ—¶æœº

### **æ˜¾ç¤ºæ—¶æœºæµç¨‹**
```mermaid
flowchart TD
    A["ç”¨æˆ·æ‹–æ‹½è¿›å…¥RGLåŒºåŸŸ"] --> B["Dragon.getRGL()æ£€æµ‹"]
    B --> C{"isRGL === true?"}
    C -->|å¦| D["å¿½ç•¥ï¼Œç»§ç»­æ™®é€šæ‹–æ‹½"]
    C -->|æ˜¯| E["ç¦ç”¨æ‹–æ‹½å…ƒç´ pointer-events"]
    E --> F["emit('rgl.sleeping', false)"]
    F --> G["sensor.locate(locateEvent)"]
    G --> H{"èƒ½å¤Ÿå®šä½åˆ°æœ‰æ•ˆä½ç½®?"}
    H -->|å¦| I["æ— æ³•æ”¾ç½®ï¼Œä¸æ˜¾ç¤ºå ä½ç¬¦"]
    H -->|æ˜¯| J["emit('rgl.add.placeholder')"]
    J --> K["å ä½ç¬¦æ¸²æŸ“ç»„ä»¶å“åº”"]
    K --> L["æ˜¾ç¤ºå ä½ç¬¦UI"]

    style J fill:#c8e6c9
    style L fill:#e8f5e8
```

### **éšè—æ—¶æœº**
1. **ç§»å‡ºRGLåŒºåŸŸ**ï¼šæ‹–æ‹½åˆ°éRGLåŒºåŸŸæ—¶è‡ªåŠ¨éšè—
2. **æ‹–æ‹½ç»“æŸ**ï¼šæ— è®ºæˆåŠŸæ”¾ç½®ä¸å¦ï¼Œéƒ½æ¸…ç†å ä½ç¬¦
3. **ESCå–æ¶ˆ**ï¼šç”¨æˆ·å–æ¶ˆæ‹–æ‹½æ—¶æ¸…ç†
4. **æ‹–æ‹½å¼‚å¸¸**ï¼šæ‹–æ‹½è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶æ¸…ç†

## ğŸ¨ å ä½ç¬¦æ ·å¼å’Œæ•ˆæœ

### **é¢„æœŸçš„å ä½ç¬¦æ ·å¼**
```css
/* RGLæ‹–æ‹½å ä½ç¬¦æ ·å¼ */
.rgl-drag-placeholder {
    position: absolute;
    border: 2px dashed #1890ff;
    background: rgba(24, 144, 255, 0.1);
    pointer-events: none;
    z-index: 9999;
    border-radius: 4px;
    transition: all 0.2s ease;
}

/* å ä½ç¬¦åŠ¨ç”»æ•ˆæœ */
.rgl-placeholder-enter {
    opacity: 0;
    transform: scale(0.9);
}

.rgl-placeholder-enter-active {
    opacity: 1;
    transform: scale(1);
    transition: opacity 0.2s, transform 0.2s;
}

.rgl-placeholder-exit {
    opacity: 1;
    transform: scale(1);
}

.rgl-placeholder-exit-active {
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 0.2s, transform 0.2s;
}
```

### **å ä½ç¬¦çš„è®¡ç®—é€»è¾‘**
```typescript
// å ä½ç¬¦ä½ç½®å’Œå¤§å°è®¡ç®—
class PlaceholderCalculator {
    calculatePlaceholderRect(rglNode: Node, draggedNode: Node, event: MouseEvent) {
        const containerRect = rglNode.getDOMNode()?.getBoundingClientRect();
        const draggedRect = draggedNode.getDOMNode()?.getBoundingClientRect();

        // è·å–ç½‘æ ¼é…ç½®
        const gridConfig = rglNode.getProp('gridConfig')?.getValue() || {
            cols: 12,
            rowHeight: 30,
            margin: [10, 10]
        };

        // å°†é¼ æ ‡ä½ç½®è½¬æ¢ä¸ºç½‘æ ¼åæ ‡
        const gridPosition = this.mouseToGridPosition(
            event.clientX - containerRect.left,
            event.clientY - containerRect.top,
            gridConfig
        );

        // è®¡ç®—å ä½ç¬¦å°ºå¯¸ï¼ˆåŸºäºæ‹–æ‹½ç»„ä»¶çš„åŸå§‹å°ºå¯¸ï¼‰
        const placeholderSize = this.calculatePlaceholderSize(draggedRect, gridConfig);

        return {
            x: gridPosition.x * gridConfig.colWidth,
            y: gridPosition.y * gridConfig.rowHeight,
            width: placeholderSize.w * gridConfig.colWidth,
            height: placeholderSize.h * gridConfig.rowHeight
        };
    }

    mouseToGridPosition(mouseX: number, mouseY: number, gridConfig: any) {
        const { colWidth, rowHeight, margin } = gridConfig;

        return {
            x: Math.floor((mouseX - margin[0]) / (colWidth + margin[0])),
            y: Math.floor((mouseY - margin[1]) / (rowHeight + margin[1]))
        };
    }
}
```

## ğŸ”§ å ä½ç¬¦çš„å®ç°æœºåˆ¶æ¨æµ‹

### **å¯èƒ½çš„ç›‘å¬è€…**

#### **1. RGLå®¹å™¨ç»„ä»¶å†…éƒ¨**
```typescript
// RGLå®¹å™¨ç»„ä»¶å¯èƒ½çš„å†…éƒ¨å®ç°
class GridLayoutContainer extends Component {
    state = {
        placeholders: new Map()  // å­˜å‚¨å¤šä¸ªå ä½ç¬¦
    };

    componentDidMount() {
        this.setupPlaceholderListeners();
    }

    setupPlaceholderListeners() {
        const designer = this.context.designer;

        // ç›‘å¬å ä½ç¬¦æ·»åŠ 
        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            if (data.rglNode === this.node) {
                const placeholderInfo = this.calculatePlaceholder(data);
                this.setState({
                    placeholders: new Map(this.state.placeholders).set(data.node.id, placeholderInfo)
                });
            }
        });

        // ç›‘å¬å ä½ç¬¦ç§»é™¤
        designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            this.setState({ placeholders: new Map() });
        });
    }

    render() {
        return (
            <div className="rgl-container">
                {/* æ­£å¸¸ç½‘æ ¼å†…å®¹ */}
                {this.renderGridItems()}

                {/* æ‹–æ‹½å ä½ç¬¦ */}
                {Array.from(this.state.placeholders.values()).map(placeholder => (
                    <div key={placeholder.id} className="rgl-placeholder" style={placeholder.style} />
                ))}
            </div>
        );
    }
}
```

#### **2. BemToolsè¾…åŠ©å·¥å…·å±‚**
```typescript
// packages/designer/src/builtin-simulator/bem-tools/å¯èƒ½å­˜åœ¨çš„RGLå·¥å…·
class RGLBemTool extends Component {
    state = { placeholders: [] };

    componentDidMount() {
        const { designer } = this.props;

        // åœ¨BemToolså±‚æ¸²æŸ“å ä½ç¬¦
        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            const placeholderElement = this.createPlaceholderElement(data);
            this.setState({
                placeholders: [...this.state.placeholders, placeholderElement]
            });
        });

        designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            this.setState({ placeholders: [] });
        });
    }

    render() {
        return (
            <div className="rgl-bem-layer">
                {this.state.placeholders.map(placeholder => placeholder)}
            </div>
        );
    }
}
```

#### **3. å…¨å±€CSSåŠ¨æ€æ³¨å…¥**
```typescript
// å¯èƒ½é€šè¿‡åŠ¨æ€CSSå®ç°å ä½ç¬¦
class RGLStyleManager {
    private styleElement: HTMLStyleElement;

    constructor(designer: Designer) {
        this.styleElement = this.createStyleElement();
        this.setupListeners(designer);
    }

    setupListeners(designer: Designer) {
        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            const { rglNode, node, event } = data;
            const rect = this.calculateRect(rglNode, event);

            // åŠ¨æ€æ³¨å…¥å ä½ç¬¦æ ·å¼
            const css = `
                .rgl-node-${rglNode.id}::after {
                    content: '';
                    position: absolute;
                    left: ${rect.x}px;
                    top: ${rect.y}px;
                    width: ${rect.width}px;
                    height: ${rect.height}px;
                    border: 2px dashed #1890ff;
                    background: rgba(24, 144, 255, 0.1);
                    pointer-events: none;
                    z-index: 9999;
                }
            `;

            this.styleElement.innerHTML = css;
        });

        designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            this.styleElement.innerHTML = '';
        });
    }
}
```

## ğŸ“Š å ä½ç¬¦çš„ä½¿ç”¨æ•ˆæœ

### **ç”¨æˆ·ä½“éªŒ**
1. **è§†è§‰æŒ‡å¼•**ï¼šæ˜ç¡®æ˜¾ç¤ºç»„ä»¶å°†è¦æ”¾ç½®çš„ä½ç½®
2. **ç½‘æ ¼å¯¹é½**ï¼šæ˜¾ç¤ºå¯¹é½åˆ°ç½‘æ ¼çš„ç²¾ç¡®ä½ç½®
3. **å°ºå¯¸é¢„è§ˆ**ï¼šé¢„è§ˆç»„ä»¶åœ¨æ–°ä½ç½®çš„å¤§å°
4. **å†²çªæç¤º**ï¼šæ˜¾ç¤ºæ˜¯å¦ä¸å…¶ä»–ç»„ä»¶å†²çª

### **äº¤äº’åé¦ˆ**
```mermaid
stateDiagram-v2
    [*] --> ç­‰å¾…æ‹–æ‹½
    ç­‰å¾…æ‹–æ‹½ --> æ£€æµ‹RGL: æ‹–æ‹½å¼€å§‹

    æ£€æµ‹RGL --> æ˜¾ç¤ºå ä½ç¬¦: isRGL && _canDrop
    æ£€æµ‹RGL --> æ™®é€šæ‹–æ‹½: !isRGL

    æ˜¾ç¤ºå ä½ç¬¦ --> æ›´æ–°å ä½ç¬¦: é¼ æ ‡ç§»åŠ¨
    æ˜¾ç¤ºå ä½ç¬¦ --> ç§»é™¤å ä½ç¬¦: ç¦»å¼€RGLåŒºåŸŸ
    æ›´æ–°å ä½ç¬¦ --> æ›´æ–°å ä½ç¬¦: ç»§ç»­æ‹–æ‹½
    æ›´æ–°å ä½ç¬¦ --> å®Œæˆæ”¾ç½®: æ¾å¼€é¼ æ ‡

    ç§»é™¤å ä½ç¬¦ --> ç­‰å¾…æ‹–æ‹½: æ‹–æ‹½ç»“æŸ
    å®Œæˆæ”¾ç½® --> ç­‰å¾…æ‹–æ‹½: æ‹–æ‹½ç»“æŸ
    æ™®é€šæ‹–æ‹½ --> ç­‰å¾…æ‹–æ‹½: æ‹–æ‹½ç»“æŸ
```

## ğŸ› ï¸ åœ¨ä¸šåŠ¡ä¸­ç›‘å¬å ä½ç¬¦äº‹ä»¶

### **è°ƒè¯•ç›‘å¬æ–¹æ¡ˆ**
```typescript
// åœ¨æ§åˆ¶å°ä¸­ç›‘å¬RGLå ä½ç¬¦äº‹ä»¶
const designer = editor.get('designer');

// ç›‘å¬å ä½ç¬¦æ·»åŠ 
const addListener = designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
    console.log('ğŸŸ¦ RGLå ä½ç¬¦æ˜¾ç¤º:', {
        targetContainer: data.rglNode?.componentName,
        draggedComponent: data.node?.componentName,
        mousePosition: { x: data.event.clientX, y: data.event.clientY },
        fromContainer: data.fromRglNode?.componentName
    });
});

// ç›‘å¬å ä½ç¬¦ç§»é™¤
const removeListener = designer.dragon.emitter.on('rgl.remove.placeholder', () => {
    console.log('ğŸš« RGLå ä½ç¬¦ç§»é™¤');
});

// æ¸…ç†ç›‘å¬å™¨
// removeListener();
// addListener();
```

### **ä¸šåŠ¡æ‰©å±•ç¤ºä¾‹**
```typescript
// è‡ªå®šä¹‰RGLå ä½ç¬¦ç®¡ç†å™¨
class BusinessRGLManager {
    private analytics: AnalyticsService;

    constructor(designer: Designer, analytics: AnalyticsService) {
        this.analytics = analytics;
        this.setupMonitoring(designer);
    }

    setupMonitoring(designer: Designer) {
        // å ä½ç¬¦æ€§èƒ½ç›‘æ§
        designer.dragon.emitter.on('rgl.add.placeholder', (data) => {
            this.analytics.track('rgl_placeholder_show', {
                containerType: data.rglNode.componentName,
                draggedType: data.node?.componentName,
                timestamp: Date.now()
            });

            this.startPlaceholderTimer();
        });

        designer.dragon.emitter.on('rgl.remove.placeholder', () => {
            const duration = this.endPlaceholderTimer();

            this.analytics.track('rgl_placeholder_hide', {
                displayDuration: duration,
                timestamp: Date.now()
            });
        });
    }

    // å ä½ç¬¦æ˜¾ç¤ºæ—¶é•¿ç»Ÿè®¡
    private placeholderStartTime: number = 0;

    startPlaceholderTimer() {
        this.placeholderStartTime = Date.now();
    }

    endPlaceholderTimer(): number {
        return Date.now() - this.placeholderStartTime;
    }
}
```

## ğŸ¯ æ€»ç»“

### **å ä½ç¬¦äº‹ä»¶çš„æ ¸å¿ƒä»·å€¼**
1. **ç²¾ç¡®åé¦ˆ**ï¼šæä¾›ç½‘æ ¼å¸ƒå±€çš„ç²¾ç¡®æ‹–æ‹½åé¦ˆ
2. **ç”¨æˆ·æŒ‡å¼•**ï¼šæ˜ç¡®æ˜¾ç¤ºç»„ä»¶çš„ç›®æ ‡ä½ç½®
3. **å†²çªé¢„é˜²**ï¼šé¢„å…ˆæ˜¾ç¤ºå¯èƒ½çš„å¸ƒå±€å†²çª
4. **ä½“éªŒä¼˜åŒ–**ï¼šå¢å¼ºRGLç»„ä»¶çš„æ‹–æ‹½ä½“éªŒ

### **å®ç°ç‰¹ç‚¹**
- **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡äº‹ä»¶æœºåˆ¶å®ç°æ¾è€¦åˆ
- **æ•°æ®ä¸°å¯Œ**ï¼šäº‹ä»¶æºå¸¦å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- **æ—¶æœºç²¾ç¡®**ï¼šåœ¨åˆé€‚çš„æ—¶æœºè§¦å‘å’Œæ¸…ç†
- **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒä¸šåŠ¡è‡ªå®šä¹‰ç›‘å¬å’Œå¤„ç†

### **ç›‘å¬è€…ç”Ÿæ€**
- **RGLç»„ä»¶**ï¼šç›´æ¥å“åº”å ä½ç¬¦æ˜¾ç¤º/éšè—
- **BemToolsç³»ç»Ÿ**ï¼šå¯èƒ½åœ¨è¾…åŠ©å·¥å…·å±‚æ˜¾ç¤º
- **è°ƒè¯•å·¥å…·**ï¼šå¼€å‘æ—¶çš„ç›‘æ§å’Œåˆ†æ
- **ä¸šåŠ¡æ‰©å±•**ï¼šè‡ªå®šä¹‰çš„äº¤äº’å¢å¼º

**RGLå ä½ç¬¦äº‹ä»¶æ˜¯ç½‘æ ¼å¸ƒå±€æ‹–æ‹½äº¤äº’çš„å…³é”®æœºåˆ¶ï¼Œé€šè¿‡ç²¾ç¡®çš„äº‹ä»¶æ—¶æœºæ§åˆ¶å®ç°äº†ä¸“ä¸šçš„ç½‘æ ¼æ‹–æ‹½ä½“éªŒã€‚**
